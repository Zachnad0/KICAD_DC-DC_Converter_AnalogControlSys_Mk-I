Version 4.1
SHEET 1 1760 1460
WIRE -704 80 -736 80
WIRE 560 80 528 80
WIRE 640 80 624 80
WIRE 688 80 640 80
WIRE 800 80 768 80
WIRE -528 112 -608 112
WIRE -560 128 -560 96
WIRE -608 144 -608 112
WIRE -592 144 -608 144
WIRE 592 144 576 144
WIRE 688 144 592 144
WIRE -528 160 -528 112
WIRE -496 160 -496 64
WIRE -496 160 -528 160
WIRE -384 160 -416 160
WIRE -336 160 -384 160
WIRE -304 160 -336 160
WIRE -224 160 -224 112
WIRE 688 160 688 144
WIRE 1280 160 1280 144
WIRE -704 176 -704 160
WIRE -592 176 -704 176
WIRE -96 176 -128 176
WIRE 592 176 592 144
WIRE 640 176 640 80
WIRE 656 176 640 176
WIRE -704 192 -704 176
WIRE 800 192 800 80
WIRE 800 192 720 192
WIRE 832 192 800 192
WIRE -384 208 -384 160
WIRE -320 208 -320 128
WIRE -288 208 -320 208
WIRE 656 208 640 208
WIRE -288 224 -288 208
WIRE -112 224 -112 144
WIRE -80 224 -112 224
WIRE 800 224 800 192
WIRE -336 240 -336 160
WIRE -320 240 -336 240
WIRE -80 240 -80 224
WIRE 688 240 688 224
WIRE 688 240 656 240
WIRE 1280 240 1168 240
WIRE -224 256 -224 160
WIRE -224 256 -256 256
WIRE -208 256 -224 256
WIRE -128 256 -128 176
WIRE -112 256 -128 256
WIRE 1280 256 1280 240
WIRE -320 272 -336 272
WIRE -32 272 -32 176
WIRE -32 272 -48 272
WIRE 0 272 0 192
WIRE 0 272 -32 272
WIRE 32 272 0 272
WIRE 160 272 160 256
WIRE 160 272 112 272
WIRE 240 272 160 272
WIRE -704 288 -704 272
WIRE -112 288 -128 288
WIRE -336 304 -336 272
WIRE -448 320 -464 320
WIRE -384 320 -384 288
WIRE -384 320 -448 320
WIRE -128 320 -128 288
WIRE 592 320 592 256
WIRE 640 320 640 208
WIRE 640 320 592 320
WIRE 688 320 640 320
WIRE 800 320 800 304
WIRE 800 320 768 320
WIRE 592 336 592 320
WIRE -432 368 -496 368
WIRE -544 384 -544 320
WIRE -528 384 -544 384
WIRE -448 400 -448 320
WIRE -448 400 -464 400
WIRE -528 416 -544 416
WIRE -544 432 -544 416
WIRE 592 432 592 416
WIRE 592 432 576 432
WIRE 656 432 656 240
WIRE 656 432 592 432
WIRE -496 480 -496 432
WIRE -496 480 -512 480
WIRE -464 608 -496 608
WIRE 544 672 528 672
WIRE -576 688 -576 608
WIRE -560 688 -576 688
WIRE -464 688 -464 608
WIRE -464 688 -496 688
WIRE 544 688 544 672
WIRE 672 688 544 688
WIRE 784 688 752 688
WIRE 832 688 784 688
WIRE 1040 688 896 688
WIRE 1120 688 1040 688
WIRE 1344 688 1120 688
WIRE 1392 688 1344 688
WIRE -224 720 -320 720
WIRE 544 736 544 688
WIRE 784 736 784 688
WIRE 784 736 752 736
WIRE -512 752 -528 752
WIRE 784 752 784 736
WIRE 1040 752 1040 688
WIRE 1120 752 1120 688
WIRE 1344 752 1344 688
WIRE -672 768 -704 768
WIRE -576 768 -576 688
WIRE -576 768 -592 768
WIRE -560 768 -576 768
WIRE -272 768 -272 656
WIRE -464 784 -464 688
WIRE -464 784 -496 784
WIRE -320 784 -320 720
WIRE -304 784 -320 784
WIRE -560 800 -576 800
WIRE -224 800 -240 800
WIRE -128 800 -128 656
WIRE -128 800 -224 800
WIRE 48 800 48 656
WIRE 48 800 -64 800
WIRE 96 800 96 736
WIRE 112 800 96 800
WIRE -464 816 -464 784
WIRE -384 816 -384 736
WIRE -384 816 -464 816
WIRE -304 816 -384 816
WIRE 208 816 176 816
WIRE 272 816 272 800
WIRE 304 816 272 816
WIRE -576 832 -576 800
WIRE -528 832 -528 816
WIRE 48 832 48 800
WIRE 112 832 48 832
WIRE 736 832 720 832
WIRE -64 880 -80 880
WIRE 544 880 544 816
WIRE 784 880 784 848
WIRE 784 880 544 880
WIRE 1040 880 1040 816
WIRE 1040 880 784 880
WIRE 1120 880 1120 816
WIRE 1120 880 1040 880
WIRE 1344 880 1344 832
WIRE 1344 880 1120 880
WIRE 544 912 544 880
FLAG 1168 160 V_CC
IOPIN 1168 160 In
FLAG 1168 320 V_EE
IOPIN 1168 320 In
FLAG 1280 256 0
FLAG -704 768 V_CLK
IOPIN -704 768 In
FLAG 96 736 V_THR
IOPIN 96 736 In
FLAG 304 816 V_PWM
IOPIN 304 816 Out
FLAG -272 832 V_EE
IOPIN -272 832 In
FLAG -512 752 V_CC
IOPIN -512 752 In
FLAG -272 656 V_CC
IOPIN -272 656 In
FLAG 144 784 V_CC
IOPIN 144 784 In
FLAG 240 272 V_THR
IOPIN 240 272 Out
FLAG 832 192 V_CLK
IOPIN 832 192 In
FLAG -128 656 C
FLAG 48 656 D
FLAG -320 640 0
FLAG -64 720 V_CC
IOPIN -64 720 In
FLAG 544 912 0
FLAG 720 832 V_PWM
IOPIN 720 832 In
FLAG 1392 688 V_O
IOPIN 1392 688 Out
FLAG -736 80 V_O
IOPIN -736 80 In
FLAG -704 288 0
FLAG 1280 144 V_TARG
IOPIN 1280 144 In
FLAG -624 384 V_TARG
IOPIN -624 384 In
FLAG -128 320 0
FLAG -560 96 V_CC
IOPIN -560 96 In
FLAG 144 848 V_EE
IOPIN 144 848 In
FLAG -560 192 V_EE
IOPIN -560 192 In
FLAG -320 128 V_CC
IOPIN -320 128 In
FLAG -288 288 V_EE
IOPIN -288 288 In
FLAG -112 144 V_CC
IOPIN -112 144 In
FLAG -80 304 V_EE
IOPIN -80 304 In
FLAG 160 176 V_CC
IOPIN 160 176 In
FLAG -496 64 E
FLAG -224 112 error
FLAG 0 192 integral_error
FLAG -384 736 B
FLAG 752 736 nMOS
FLAG 544 672 V_supply
FLAG -576 832 0
FLAG -528 832 V_EE
IOPIN -528 832 In
FLAG 576 144 V_CC
IOPIN 576 144 In
FLAG 576 432 V_EE
IOPIN 576 432 In
FLAG 528 80 V_EE
IOPIN 528 80 In
FLAG -80 880 V_EE
IOPIN -80 880 In
FLAG -512 480 V_EE
IOPIN -512 480 In
FLAG 272 720 V_CC
IOPIN 272 720 In
FLAG -432 368 V_CC
IOPIN -432 368 In
FLAG -544 432 0
FLAG -336 304 0
SYMBOL res -576 752 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 1k
SYMBOL res -480 592 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 10k
SYMBOL cap -496 672 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C2
SYMATTR Value 8.2n
SYMBOL voltage 1168 144 R0
WINDOW 0 41 59 Left 2
WINDOW 3 27 19 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 5
SYMBOL voltage 1168 224 R0
WINDOW 0 40 61 Left 2
WINDOW 3 34 28 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value 5
SYMBOL res -304 736 R180
WINDOW 0 28 78 Left 2
WINDOW 3 32 47 Left 2
SYMATTR InstName R3
SYMATTR Value 10k
SYMBOL res -240 704 R0
WINDOW 0 36 39 Left 2
WINDOW 3 -30 -9 Left 2
SYMATTR InstName R4
SYMATTR Value {R_trigGain}
SYMBOL cap -64 784 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 31 54 VTop 2
SYMATTR InstName C3
SYMATTR Value 100n
SYMBOL res -80 704 R0
SYMATTR InstName R5
SYMATTR Value 10k
SYMBOL res -80 784 R0
SYMATTR InstName R6
SYMATTR Value 30k
SYMBOL OpAmps\\UniversalOpAmp2 -528 784 R0
WINDOW 0 28 30 Left 2
SYMATTR InstName U2
SYMATTR Value2 Avol=200k GBW={GBW} Slew={slewRate}
SYMATTR SpiceLine Ilimit=40m Rail={railV} Vos=0
SYMATTR SpiceLine2 En=0 Enk=0 In=0 Ink=0 Rin=10Meg
SYMBOL OpAmps\\UniversalOpAmp2 -272 800 R0
WINDOW 0 28 30 Left 2
SYMATTR InstName U1
SYMATTR Value2 Avol=200k GBW={GBW} Slew={slewRate}
SYMATTR SpiceLine Ilimit=40m Rail={railV} Vos=0
SYMATTR SpiceLine2 En=0 Enk=0 In=0 Ink=0 Rin=10Meg
SYMBOL OpAmps\\UniversalOpAmp2 144 816 R0
WINDOW 0 28 30 Left 2
SYMATTR InstName U3
SYMATTR Value2 Avol=200k GBW={GBW} Slew={slewRate}
SYMATTR SpiceLine Ilimit=40m Rail={railV} Vos=0
SYMATTR SpiceLine2 En=0 Enk=0 In=0 Ink=0 Rin=10Meg
SYMBOL ind 656 704 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 22µ
SYMATTR SpiceLine Rser=30m
SYMBOL voltage 544 720 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V5
SYMATTR Value 5
SYMBOL diode 832 704 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D1
SYMATTR Value 1N5819
SYMBOL nmos 736 752 R0
SYMATTR InstName M1
SYMATTR Value IPB039N04L
SYMBOL res -720 64 R0
SYMATTR InstName R8
SYMATTR Value 150k
SYMBOL res -720 176 R0
SYMATTR InstName R9
SYMATTR Value 13k
SYMBOL OpAmps\\UniversalOpAmp2 -560 160 R0
WINDOW 0 -57 42 Left 2
SYMATTR InstName U4
SYMATTR Value2 Avol=200k GBW={GBW} Slew={slewRate}
SYMATTR SpiceLine Ilimit=40m Rail={railV} Vos=0
SYMATTR SpiceLine2 En=0 Enk=0 In=0 Ink=0 Rin=10Meg
SYMBOL OpAmps\\UniversalOpAmp2 -288 256 R0
WINDOW 0 28 30 Left 2
SYMATTR InstName U5
SYMATTR Value2 Avol=200k GBW={GBW} Slew={slewRate}
SYMATTR SpiceLine Ilimit=40m Rail={railV} Vos=0
SYMATTR SpiceLine2 En=0 Enk=0 In=0 Ink=0 Rin=10Meg
SYMBOL OpAmps\\UniversalOpAmp2 -80 272 R0
WINDOW 0 28 30 Left 2
SYMATTR InstName U6
SYMATTR Value2 Avol=200k GBW={GBW} Slew={slewRate}
SYMATTR SpiceLine Ilimit=40m Rail={railV} Vos=0
SYMATTR SpiceLine2 En=0 Enk=0 In=0 Ink=0 Rin=10Meg
SYMBOL res -400 144 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R10
SYMATTR Value 10k
SYMBOL res -208 144 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 10k
SYMBOL voltage 1280 144 R0
WINDOW 0 38 57 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 25 12 Left 2
SYMATTR InstName V6
SYMATTR Value 5
SYMBOL res -112 240 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R14
SYMATTR Value 1k
SYMBOL cap -32 160 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C5
SYMATTR Value 3.3µ
SYMBOL res 128 256 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R15
SYMATTR Value 1k
SYMBOL res 144 160 R0
SYMATTR InstName R17
SYMATTR Value 1k
SYMBOL cap 1104 752 R0
SYMATTR InstName C8
SYMATTR Value 1µ
SYMATTR SpiceLine Rser=1m
SYMBOL polcap 1024 752 R0
SYMATTR InstName C6
SYMATTR Value 220µ
SYMATTR SpiceLine Rser=120m
SYMBOL OpAmps\\UniversalOpAmp2 688 192 R0
WINDOW 0 35 18 Left 2
SYMATTR InstName U7
SYMATTR Value2 Avol=200k GBW={GBW} Slew={slewRate}
SYMATTR SpiceLine Ilimit=40m Rail={railV} Vos=0
SYMATTR SpiceLine2 En=0 Enk=0 In=0 Ink=0 Rin=10Meg
SYMBOL cap 624 64 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C4
SYMATTR Value 10n
SYMBOL res 784 64 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value 1k
SYMBOL res 784 304 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R16
SYMATTR Value 5k
SYMBOL res 608 272 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R18
SYMATTR Value 2.2k
SYMBOL res 608 432 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R19
SYMATTR Value 2.2k
SYMBOL res 784 208 R0
WINDOW 3 29 80 Left 2
SYMATTR Value {R_osc}
SYMATTR InstName R20
SYMBOL current 1344 752 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName I1
SYMATTR Value 0.4
SYMBOL OpAmps\\UniversalOpAmp2 -496 400 R0
WINDOW 0 21 34 Left 2
SYMATTR InstName U8
SYMATTR Value2 Avol=200k GBW={GBW} Slew={slewRate}
SYMATTR SpiceLine Ilimit=40m Rail={railV} Vos=0
SYMATTR SpiceLine2 En=0 Enk=0 In=0 Ink=0 Rin=10Meg
SYMBOL res 256 704 R0
SYMATTR InstName R21
SYMATTR Value 10k
SYMBOL cap 272 800 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 37 26 VTop 2
SYMATTR InstName C1
SYMATTR Value 100n
SYMBOL res -560 336 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R22
SYMATTR Value 12k
SYMBOL res -640 400 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R23
SYMATTR Value 30k
SYMBOL res -368 304 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R24
SYMATTR Value 10k
TEXT -712 -432 Left 2 !.tran 0 40m 0 0.1u startup
TEXT -712 -392 Left 2 !.meas TRAN V_b_max MAX V(b)
TEXT -712 -168 Left 2 !.param R_trigGain = 12.8k
TEXT -712 -368 Left 2 !.meas TRAN R_f1_optimal PARAM {(2.5 / V_b_max - 1) * 10k}
TEXT -712 -96 Left 2 !.param slewRate = 15Meg
TEXT -712 -120 Left 2 !.param GBW = 3Meg
TEXT -712 -344 Left 2 !.meas TRAN P_AVG_SUPPLY AVG {abs( V(V_supply) * I(V5) )} FROM 15m
TEXT -712 -272 Left 2 !.meas TRAN P_AVG_FET AVG {V(nMOS) * Id(M1)} FROM 15m
TEXT -808 576 Left 2 ;PWM Gen.
TEXT -240 672 Left 2 ;Pot. #1
TEXT -816 8 Left 2 ;PI Controller
TEXT 480 608 Left 2 ;Boost Converter
TEXT 416 8 Left 2 ;Hysterisis 100kHz Square Oscillator (+/- 10% tol.)
TEXT -712 -144 Left 2 !.param R_osc = 5k
TEXT 880 256 Left 2 ;Pot. #2
TEXT 1088 0 Left 2 ;Supply and Target Voltages
TEXT -712 -320 Left 2 !.meas TRAN P_AVG_LOAD AVG {abs( V(V_O) * I(I1) )} FROM 15m
TEXT -712 -296 Left 2 !.meas TRAN P_EFFICIENCY PARAM {P_AVG_LOAD / P_AVG_SUPPLY}
TEXT 376 -256 Left 2 !.meas TRAN I_AVG_D1 AVG {I(D1)} FROM 10m
TEXT -712 -248 Left 2 !.meas TRAN P_AVG_D1 AVG {abs(V(nMOS,V_O) * I(D1))} FROM 15m
TEXT -712 -192 Left 2 !.param railV = 1
RECTANGLE Normal 432 944 -832 544
RECTANGLE Normal 1040 480 400 -16
RECTANGLE Normal 1472 944 464 592
RECTANGLE Normal 1408 416 1072 -16
RECTANGLE Normal 368 512 -832 -16
